<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Ayam Potong</title>
     <link rel="manifest" href="/manifest.json">
     <link rel="shortcut icon" href="img/logo.png" type="image/x-icon">
     <link rel="preconnect" href="https://fonts.googleapis.com">
     <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
     <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap" rel="stylesheet">
     <link rel="stylesheet" href="css/styles.css">
     <link rel="stylesheet" href="css/checkout.css">
</head>
<body>
<div>
     <a href="cart.html" class="cs-top-page">
          <img src="img/arrow-narrow-left.svg" alt="arrow-left">
          <h7 style="color: black; font-size: 20px;"> Checkout</h7>
     </a>
     

     <div class="fill" style=" font-size: 14px;">
          <div class="Alamat-checkout">
               <h4 style="color: black; margin-left: 20px; margin-bottom: 10px;">Alamat Pengantaran</h4>
               <a href="account.html">
                    <div style="display: flex; justify-content: center;">
                         <div class="box-alamat-checkout" id="id-alamat-lengkap-input"> (+) Tambah alamat</div>
                    </div>
               </a>
          </div>
     
          <div class="hari-jam">
               <div class="hari-antar" style="width: 130px;">
                    <h4 style="color: black;"> Hari antar</h4>
                    <select id="id-hari-antar-input" class="my-input-class">
                         <option value="Senin">Senin</option>
                         <option value="Selasa">Selasa</option>
                         <option value="Rabu">Rabu</option>
                         <option value="Kamis">Kamis</option>
                         <option value="Jumat">Jumat</option>
                         <option value="Sabtu">Sabtu</option>
                         <option value="Minggu">Minggu</option>
                    </select>
               </div>
               <div style="display: flex; justify-content: center; align-items: center;"> 
               <div class="jam-antar">
                    <h4 style="color: #F4F4F4; margin-top: 30px;">Jam</h4>
                    <div style="position: relative;">
                         <button id="time-button">09:00</button>
                         <div id="time-dropdown"></div>
                    </div>
     
                    <!-- Selected Time -->
                    <div>
                         <span id="selected-time"></span>
                    </div>
               </div>
               </div>
          </div>
          <div class="catatan-tambahan">
               <h4 style="color: black; margin-left: 20px; margin-bottom: 10px;">Catatan Tambahan (opsional) </h4>
               <div style="display: flex; justify-content: center;">
               <textarea class="box-catatan-tambahan" id="id-catatan-input" placeholder="(Cth : dipasar titip bumbu / kecap / tidak perlu ampela dll)" ></textarea>
               </div>
          </div>
     </div>

     <div class="cs-metode-pembayaran">
          <h4 style="color: black; margin-left: 20px;"> Metode Pembayaran</h4>
          <p style="margin-left: 40px;"> COD / Bayar ditempat</p>
     </div>

     <div id="id-rincian-pesanan">
          <h4 style="color: black; margin-left: 20px;"> Rincian Pesanan</h4>
          <div id="order-details" style="display: flex; flex-direction: column;">
               <!-- Order details will be inserted here dynamically -->
          </div>
     </div>

     <div class="cs-rincian-pembayaran">
          <h4 style="color: black; margin-left: 20px;"> Rincian Pembayaran</h4>
          <div style="display: flex; flex-direction: column;">
               <div style="display: flex; flex-direction: row; justify-content: space-between;">
                    <p style="margin-left: 40px;" > Subtotal untuk produk</p>
                    <p id="subtotal" style="margin-right: 20px;" > Rp. 0</p>
               </div>
               <div style="display: flex; flex-direction: row; justify-content: space-between;">
                    <p style="margin-left: 40px;" > Ongkos kirim</p>
                    <p style="margin-right: 20px;"> Rp. 0</p>
               </div>
          </div>
     </div>
     
     
<div class="modal-overlay" id="modal-overlay">
     <div class="modal-content">
          <button class="close-send-btn" id="close-send-btn">x</button>
          <div style="height: 80px; background-color: #075F55; border-radius: 20px 20px 0px 0px;display: flex; flex-direction: row; padding: 10px; padding-left: 20px; gap: 20px;  align-items: center;">
          <img src="img/logo.png" alt="" style="width: 60px; height: 60px; background-color: #ffffff; border-radius: 50%;">
          <Pre>
<span style="font-weight: bold;">Ayam Potong Antar </span>
Akun bisnis
</Pre>
     </div>
          <section class="confirm">
               <div style="background-color: rgb(255, 255, 255); width: 240px; border-radius: 15px; padding: 20px; margin-left: 20px; margin-top: 30px; margin-bottom: 20px;">
                    <p style="color: black; font-size: 14px;">
                         Halo, dengan ini kamu dapat memesan lewat whatsapp dengan mudah
                    </p>
               </div>
               <div class="box-text-send" >
                    <p class="scrollable-content" id="id-text-send" style="font-size: 14px; ">
                         <!-- teks akan dimunculkan disini -->
                    </p>
               </div>
               <button id="send-whatsapp" class="close-and-send">
                    <a id="id-send-whatsapp">
                         <img src="./img/whatsapp.svg" alt="whatsapp" style="width: 30px; right: 10px;"> Kirim
                    </a>
               </button>
          </section>
     </div>
</div>
<div style="height: 120px;"></div>

<nav class="cs-bottom-page">
     <a class="cs-total-harga">
          <p> Total pembayaran</p>
          <p id="total-payment" style="color: var(--1);"> Rp. 0</p>
     </a>
     <button id="show-section-confirm-btn" class="into-whatsapp">
          Buat Pesanan
     </button>
</nav>
</div>


<div class="error-container-red" id="lengkapi-alamat-terlebih-dahulu" onclick="hideAlert()">
     <button type="button" aria-label="close-error" class="error-button-red">
          <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round"
               stroke-linejoin="round" class="close-icon" xmlns="http://www.w3.org/2000/svg">
               <path d="M18 6 6 18"></path>
               <path d="m6 6 12 12"></path>
          </svg>
     </button>
     <p class="error-message">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" color="red"
               stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
               class="feather feather-alert-triangle">
               <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z">
               </path>
               <line x1="12" y1="9" x2="12" y2="13"></line>
               <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
          <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
          <path d="M12 9v4"></path>
          <path d="M12 17h.01"></path>
          <span style="color: rgb(212, 72, 72);">lengkapi alamat <br>
                terlebih dahulu</span>
     </p>
</div>
<script src="/service-worker.js"></script>
<script>
     // Ambil data dari localStorage
     const selectedItems = JSON.parse(localStorage.getItem('selectedItems')) || [];
     const orderDetailsContainer = document.getElementById('order-details');
     const subtotalElement = document.getElementById('subtotal');
     const totalPaymentElement = document.getElementById('total-payment');

     const addressElement = document.getElementById('id-alamat-lengkap-input');
     const dayElement = document.getElementById('id-hari-antar-input');
     const timeElement = document.getElementById('time-button');
     const notesElement = document.getElementById('id-catatan-input');

     function formatRupiah(angka) {
               return angka.toLocaleString('id-ID', { style: 'currency', currency: 'IDR' }).replace(',00', '');
          }
     

     function renderOrderDetails() {
               orderDetailsContainer.innerHTML = '';
               let subtotal = 0;

               if (selectedItems.length === 0) {
                    orderDetailsContainer.innerHTML = '<p>Tidak ada item dalam pesanan.</p>';
                    return;
               }

               selectedItems.forEach((item) => {
                    const itemElement = document.createElement('div');
                    itemElement.classList.add('order-item');
                    // Hapus teks "Potong" jika item.slash bernilai 0
                    const potongText =
                         item.slash && item.slash !== 0 ? `- <span> potong ${item.slash}</span>` : "";
                    itemElement.innerHTML = `
               <div style="display: flex; flex-direction: row; justify-content: space-between;">
                    <p style="margin-left: 40px;"> ${item.name} "${item.weight}" ${potongText}</p>
                    <p style="margin-right: 20px;"> x ${item.quantity}</p>
               </div>`;
                    orderDetailsContainer.appendChild(itemElement);

                    subtotal += item.price * item.quantity;
               });

               subtotalElement.innerText = `${formatRupiah(subtotal)}`;
               totalPaymentElement.innerText = `${formatRupiah(subtotal)}`;
          }

          renderOrderDetails();


     


     // alamat
     function loadAlamatToCheckout() {
          const savedData = JSON.parse(localStorage.getItem('formData'));

          if (savedData) {
               // Menampilkan alamat di elemen yang diinginkan
               const alamatElement = document.getElementById('id-alamat-lengkap-input');
               alamatElement.innerText = `${savedData.nama}, ${savedData.alamat}, ${savedData.kelurahan}`;
          }
          function showAlert() {
               document.getElementById('lengkapi-alamat-terlebih-dahulu').classList.add('show');
               setTimeout(hideAlert, 4000);
          }
          function hideAlert() {
               document.getElementById('lengkapi-alamat-terlebih-dahulu').classList.remove('show');
          }




          document.getElementById('send-whatsapp').addEventListener('click', () => {
               const address = addressElement.innerText;
               const day = dayElement.value;
               const time = timeElement.textContent;
               const notes = notesElement.value;
               const subtotal = subtotalElement.innerText;

               let orderDescription = '';
               selectedItems.forEach(item => {
                    const potongText =
                         item.slash && item.slash !== 0 ? `- <span> potong ${item.slash}</span>` : "";
                    orderDescription += `${item.quantity} ${item.name} "${item.weight}" ${potongText}\n`;
               });

               const message = `halo, saya ${savedData.nama}  pesan ayam potong dengan rincian berikut:\n\n` +
                    `*Deskripsi pesanan*\n${orderDescription}\n` +
                    `*Pengantaran*\nHari: ${day}\nJam: ${time} \nAlamat: ${savedData.alamat}, ${savedData.kelurahan}\n\n` +
                    `${notes}"\n` +
                    `*Total Harga*: ${subtotal}\n`;

               const encodedMessage = encodeURIComponent(message);
               const phoneNumber = '628993300818';
               const whatsappURL = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;

               window.open(whatsappURL, '_blank');
          });


          function renderTextSend() {
               const address = addressElement.innerText;
               const day = dayElement.value;
               const time = timeElement.textContent;
               const notes = notesElement.value;
               const subtotal = subtotalElement.innerText;
               

               let orderDescription = '';
               selectedItems.forEach(item => {
                    const potongText =
                         item.slash && item.slash !== 0 ? `- <span> potong ${item.slash}</span>` : "";
                    orderDescription += `${item.quantity} ${item.name} \"${item.weight}\" ${potongText}\n`;
               });

               const message = `halo, saya ${savedData.nama} pesan ayam potong dengan rincian berikut:\n\n` +
                    `*Deskripsi pesanan*\n${orderDescription}\n` +
                    `*Pengantaran*\nHari: ${day}\nJam: ${time} \nAlamat: ${savedData.alamat}, ${savedData.kelurahan}\n\n` +
                    `${notes}\n` +
                    `*Total Harga*: ${subtotal}\n`;

               // Menampilkan teks di elemen id-text-send
               const textSendElement = document.getElementById('id-text-send');
               textSendElement.textContent = message;
          }

          function initializeTextSendSync() {
               window.addEventListener('load', renderTextSend);
               addressElement.addEventListener('input', renderTextSend);
               dayElement.addEventListener('change', renderTextSend);
               timeElement.addEventListener('click', renderTextSend);
               notesElement.addEventListener('input', renderTextSend);
               renderTextSend();
          }
          initializeTextSendSync();


          // Tombol dan elemen modal
          const showButton = document.getElementById("show-section-confirm-btn");
          const modalOverlay = document.getElementById("modal-overlay");
          const closeButton = document.getElementById("close-send-btn");

          // Fungsi untuk membuka modal
          showButton.addEventListener("click", () => {
               // tinggal bingun nempatinnya gimana
               if (savedData.nama === '') {
                    showAlert()
                    return
               }
               if (savedData.alamat === '') {
                    showAlert()
                    return
               }
               modalOverlay.style.display = "flex"; // Tampilkan modal
          });

          // Fungsi untuk menutup modal
          closeButton.addEventListener("click", () => {
               modalOverlay.style.display = "none"; // Sembunyikan modal
          });

          // Menutup modal jika klik di luar modal-content
          modalOverlay.addEventListener("click", (event) => {
               if (event.target === modalOverlay) {
                    modalOverlay.style.display = "none";
               }
          });
     }

     


     // waktu antar
     const timeButton = document.getElementById("time-button");
     const timeDropdown = document.getElementById("time-dropdown");
     const selectedTimeDisplay = document.getElementById("selected-time");

     // generate
     const times = Array.from({ length: 4 }, (_, index) => {
          const hour = 9 + index * 3; // dari 7 nyampe 19
          return `${hour.toString().padStart(2, "0")}:00`;
     });

     // dropdown menu
     times.forEach((time) => {
          const timeOption = document.createElement("div");
          timeOption.textContent = time;
          timeOption.style.padding = "12px";
          timeOption.style.cursor = "pointer";
          timeOption.style.color = "#4a4a4a";

          // Add hover effect 
          timeOption.addEventListener("mouseover", () => {
               timeOption.style.backgroundColor = "#e5e7eb";
          });
          timeOption.addEventListener("mouseout", () => {
               timeOption.style.backgroundColor = "transparent";
          });

          // Handle click event
          timeOption.addEventListener("click", () => {
               timeButton.textContent = time; // munculin tombol
               timeDropdown.style.display = "none"; // sembunyiin dropdown
          });

          timeDropdown.appendChild(timeOption);
     });

     // Toggle dropdown yerlihat
     timeButton.addEventListener("click", (event) => {
          event.stopPropagation();
          timeDropdown.style.display = timeDropdown.style.display === "none" || !timeDropdown.style.display ? "block" : "none";
     });

     // tutup dropdown
     document.addEventListener("click", (event) => {
          if (!timeDropdown.contains(event.target)) {
               timeDropdown.style.display = "none"; // sembunyiin dropdown
          }
     });

     // Tambahkan event listener untuk tombol send-whatsapp
          document.getElementById('send-whatsapp').addEventListener('click', function () {
               localStorage.removeItem('cart'); // Hapus data keranjang
               renderCart(); // Perbarui tampilan agar kosong
          });

     // Jalankan fungsi saat halaman dimuat
     window.addEventListener('load', loadAlamatToCheckout);
     
      


</script>
</body>
</html>